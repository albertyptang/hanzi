angular.module("hzzd",[]),angular.module("hzzd").controller("canvasCtrl",["$scope","router","dictionary","canvas","$timeout",function(a,b,c,d,e){a.router=b,a.dictionary=c,a.changeCharacter=function(a){e(c.changeCharacter.call(c,a))},a.canvas=d.canvas;var f,g=d.context,h=function(){d.inkManager.isEmpty()?a.changeCharacter(""):d.doRecognition().then(function(b){a.dictionary.memory.push(b),a.changeCharacter(b)})};a.canvas.addEventListener("pointerdown",function(a){f||(f=a.pointerId,a.preventDefault(),d.textRenderer.drawStart(a.offsetX,a.offsetY),d.inkManager.startInkCapture(a.offsetX,a.offsetY))},!1),a.canvas.addEventListener("pointermove",function(a){f===a.pointerId&&(a.preventDefault(),d.textRenderer.drawContinue(a.offsetX,a.offsetY,g),d.inkManager.continueInkCapture(a.offsetX,a.offsetY))},!1),a.canvas.addEventListener("pointerup",function(a){f===a.pointerId&&(a.preventDefault(),d.textRenderer.drawEnd(a.offsetX,a.offsetY,g),d.inkManager.endInkCapture(),f=void 0,h())},!1),a.canvas.addEventListener("pointerleave",function(a){f===a.pointerId&&(a.preventDefault(),d.textRenderer.drawEnd(a.offsetX,a.offsetY,g),d.inkManager.endInkCapture(),f=void 0,h())},!1)}]),angular.module("hzzd").controller("menuCtrl",["$scope","router","dictionary","canvas","$timeout",function(a,b,c,d,e){a.router=b,a.switchState=function(a){b.switchState(a)},a.dictionary=c,a.lookupCharacter=function(){c.lookupCharacter()},a.clear=function(){c.changeCharacter(""),c.memory=[],c.definitions=[],d.textRenderer.clear(d.context),d.inkManager.clear()},a.undo=function(){d.inkManager.undo();var a=d.inkManager.getStrokes();d.textRenderer.clear(d.context),d.textRenderer.drawStrokes(a,d.context),c.memory.pop(),c.changeCharacter(c.memory[c.memory.length-1])}}]),angular.module("hzzd").factory("canvas",function(){var a,b=document.getElementById("canvas"),c=b.getContext("2d"),d="b9143c12-51f5-43b6-a356-7bd6cf26eb3b",e="9bc1b788-24f2-481f-9937-82a2c2397700",f=new MyScript.InkManager,g=new MyScript.TextRenderer,h=new MyScript.TextRecognizer;h.getParameters().setLanguage("zh_TW");var i=function(){var b=new MyScript.TextInputUnit;b.setComponents(f.getStrokes());var c=[b];return h.doSimpleRecognition(d,a,c,e).then(function(b){if(a){if(a!==b.getInstanceId())return}else a=b.getInstanceId();var c=b.getTextDocument().getTextSegment().getSelectedCandidate().getLabel();return c[0]})};return{canvas:b,context:c,applicationKey:d,hmacKey:e,inkManager:f,textRenderer:g,textRecognizer:h,doRecognition:i}}),angular.module("hzzd").factory("dictionary",["$http",function(a){var b=[],c=[];for(var d in window.localStorage)d.charCodeAt(0)>=13312&&d.charCodeAt(0)<=40959&&b.push(d);var e=function(a){this.character=a},f=function(){var b=this,c=this.character,d=c.charCodeAt(0);return 13312>d||d>40959?void(b.definitions=[{traditional:"Sorry",definition:"Try writing a Chinese character"}]):void a.post("/dic",{character:c}).success(function(a){if(a[0]){if(b.definitions=a,localStorage.getItem(c))return;b.history.push(c);for(var d;b.history.length>20;)d=b.history.pop(),localStorage.removeItem(d);localStorage.setItem(c,1)}else b.definitions=[]}).error(function(a,b,c,d){console.log("error: ",b)})};return{character:"",definitions:[],history:b,memory:c,changeCharacter:e,lookupCharacter:f}}]),angular.module("hzzd").factory("router",function(){var a=function(a){this.state=a};return{state:"draw",switchState:a}});